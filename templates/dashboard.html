<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Koktel Dashboard</title>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 25px;
            background: #f5f7fa;
        }

        h1 {
            margin-bottom: 20px;
        }

        h2 {
            margin-top: 40px;
        }

        select {
            padding: 8px;
            font-size: 16px;
            margin-left: 10px;
        }

        canvas {
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .top-bar {
            margin-bottom: 20px;
        }

        a {
            text-decoration: none;
            color: #007bff;
            margin-right: 15px;
            font-weight: bold;
        }

        a:hover {
            text-decoration: underline;
        }

        .container {
            width: 90%;
            margin: auto;
        }
    </style>
</head>

<body>

<div class="top-bar">
    <a href="/unos_narudzbe">‚¨Ö Unos narud≈æbe</a>
    <a href="/transakcije">Pregled transakcija</a>
    <a href="/tv">TV ekran</a>
</div>

<h1>üìä Koktel Dashboard</h1>

<label for="koktelSelect">Izaberi koktel:</label>
<select id="koktelSelect">
    {% for k in kokteli %}
        <option value="{{ k.id }}">{{ k.naziv }}</option>
    {% endfor %}
</select>

<h2>üìà Istorija cena</h2>
<canvas id="cenaChart" height="120"></canvas>

<h2>ü•É Prodaja po minutima</h2>
<canvas id="prodajaChart" height="120"></canvas>

<script>
let cenaChart;
let prodajaChart;

const select = document.getElementById("koktelSelect");

function ucitajIstorijuCena(id) {
    fetch(`/api/istorija_cena/${id}`)
        .then(r => r.json())
        .then(data => {
            const labels = data.map(d => d.vreme);
            const cene = data.map(d => d.nova);

            if (cenaChart) cenaChart.destroy();

            const ctx = document.getElementById('cenaChart').getContext('2d');
            cenaChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Cena (EUR)",
                        data: cene,
                        borderWidth: 3,
                        borderColor: "rgb(0, 123, 255)",
                        backgroundColor: "rgba(0, 123, 255, 0.1)",
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: {
                    scales: {
                        x: {
                            ticks: { maxRotation: 45, minRotation: 45 }
                        }
                    }
                }
            });
        });
}

function ucitajProdaju(id) {
    fetch(`/api/prodaja/${id}`)
        .then(r => r.json())
        .then(data => {
            const labels = data.map(d => d.vreme);
            const kol = data.map(d => d.kolicina);

            if (prodajaChart) prodajaChart.destroy();

            const ctx = document.getElementById('prodajaChart').getContext('2d');
            prodajaChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Broj prodatih koktela",
                        data: kol,
                        backgroundColor: "rgba(255, 99, 132, 0.5)",
                        borderColor: "rgb(255, 99, 132)",
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: {
                        x: {
                            ticks: { maxRotation: 45, minRotation: 45 }
                        }
                    }
                }
            });
        });
}

// Promena koktela u dropdownu
select.addEventListener("change", () => {
    const id = select.value;
    ucitajIstorijuCena(id);
    ucitajProdaju(id);
});

// Uƒçitaj prvog koktela ƒçim se otvori dashboard
if (select.value) {
    const initial = select.value;
    ucitajIstorijuCena(initial);
    ucitajProdaju(initial);
}
</script>

</body>
</html>
